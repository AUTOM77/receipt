<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mirror Payment Interface</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Babel for in-browser JSX transformation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
      body {
        font-family: 'Inter', sans-serif;
        background-color: #e5e5e5; /* Neutral background to make phones pop */
      }
      /* Custom scrollbar hiding for cleaner mobile look */
      .no-scrollbar::-webkit-scrollbar {
        display: none;
      }
      .no-scrollbar {
        -ms-overflow-style: none;
        scrollbar-width: none;
      }
    </style>
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
        "lucide-react": "https://esm.sh/lucide-react@0.292.0",
        "html-to-image": "https://esm.sh/html-to-image@1.11.11"
      }
    }
    </script>
  </head>
  <body>
    <div id="root"></div>

    <script type="text/babel" data-type="module">
      import React, { useState, useRef } from 'react';
      import { createRoot } from 'react-dom/client';
      import { 
        Camera, RotateCcw, CreditCard, User, Calendar, DollarSign, Hash, FileText,
        ArrowLeft, ChevronRight, Tag, Plus,
        Home, CircleDollarSign, Gift, UserCircle2, Search, Settings, X
      } from 'lucide-react';
      import { toPng } from 'html-to-image';

      // --- Common UI Components ---

      const StatusBar = ({ theme = 'dark' }) => {
        // theme 'dark' means dark text (for light backgrounds)
        // theme 'light' means light text (for dark backgrounds)
        const textColor = theme === 'light' ? 'text-white' : 'text-black';
        const batteryOpacity = theme === 'light' ? 'opacity-40' : 'opacity-30'; // Slightly clearer border on light
        const batteryColor = theme === 'light' ? 'white' : 'black';

        return (
            <div className={`w-full px-7 pt-3.5 pb-2 flex justify-between items-center ${textColor} relative z-20 select-none`}>
                {/* Time - Adjusted for corner curvature */}
                <div className="text-[16px] font-semibold leading-none tracking-normal pl-1">9:41</div>
                
                {/* Status Icons */}
                <div className="flex items-center gap-1.5 pr-1">
                    {/* Cellular Signal - Bars style */}
                    <div className="flex items-end gap-[2px] h-[11px]">
                        <div className={`w-[3px] h-[4px] bg-${batteryColor} rounded-[1px]`}></div>
                        <div className={`w-[3px] h-[6px] bg-${batteryColor} rounded-[1px]`}></div>
                        <div className={`w-[3px] h-[8px] bg-${batteryColor} rounded-[1px]`}></div>
                        <div className={`w-[3px] h-[10.5px] bg-${batteryColor} rounded-[1px]`}></div>
                    </div>
                    
                    {/* 5G Text */}
                    <div className="text-[13px] font-semibold ml-0.5 mr-0.5">5G</div>

                    {/* iOS 17 Battery Icon */}
                    <div className="relative ml-0.5 flex items-center">
                        {/* Battery Body */}
                        <div 
                          className={`w-[25px] h-[12px] rounded-[3.5px] border-[1px] flex items-center p-[1.5px] ${batteryOpacity}`}
                          style={{ borderColor: batteryColor }}
                        ></div>
                        {/* Battery Level (Inside) */}
                        <div 
                          className={`absolute left-[2px] top-[2px] bottom-[2px] w-[18px] rounded-[1.5px]`}
                          style={{ backgroundColor: batteryColor }}
                        ></div>
                        {/* Battery Tip */}
                        <div 
                           className={`absolute -right-[1.5px] w-[1.5px] h-[4px] rounded-r-[1px] ${batteryOpacity}`}
                           style={{ backgroundColor: batteryColor }}
                        ></div>
                    </div>
                </div>
            </div>
        );
      };

      const PhoneFrame = ({ children, className = "" }) => (
        <div className={`w-[390px] h-[820px] bg-black shadow-2xl rounded-[56px] border-[8px] border-[#1a1a1a] relative overflow-hidden ring-4 ring-gray-300/50 flex flex-col ${className}`}>
          {/* Dynamic Island / Notch */}
          <div className="absolute top-[11px] left-1/2 transform -translate-x-1/2 w-[120px] h-[35px] bg-black rounded-[20px] z-50 pointer-events-none transition-all duration-300"></div>
          
          {/* Screen Content - Use flex-col and overflow-hidden to clip corners strictly */}
          <div className="w-full h-full relative overflow-hidden flex flex-col bg-white rounded-[46px]">
            {children}
          </div>
        </div>
      );

      // --- Component: ControlPanel (iOS Settings Style) ---

      const SettingsSection = ({ title, children }) => (
        <div className="mb-6">
            {title && <h2 className="text-[13px] text-gray-500 uppercase font-normal ml-4 mb-2 tracking-wide">{title}</h2>}
            <div className="bg-white rounded-xl overflow-hidden mx-4 shadow-[0_1px_2px_rgba(0,0,0,0.05)]">
                {children}
            </div>
        </div>
      );

      const SettingsInput = ({ label, name, value, onChange, placeholder, isLast }) => (
        <div className={`flex items-center justify-between py-3.5 pl-4 pr-4 bg-white ${!isLast ? 'border-b border-gray-100' : ''} group`}>
          <label className="text-[16px] font-medium text-slate-900 w-1/3 shrink-0 whitespace-nowrap">{label}</label>
          <input
            type="text"
            name={name}
            value={value}
            onChange={onChange}
            placeholder={placeholder}
            className="w-full text-right text-[16px] text-blue-600 placeholder:text-slate-300 bg-transparent outline-none font-normal"
          />
        </div>
      );

      const ControlPanel = ({ data, onChange, onScreenshot, onReset }) => {
        const handleChange = (e) => {
          const { name, value } = e.target;
          onChange({ ...data, [name]: value });
        };

        return (
          <div className="flex flex-col h-full bg-[#f2f2f7] font-sans">
            <StatusBar theme="dark" />
            
            {/* Header */}
            <div className="px-4 pt-1 pb-2">
                <h1 className="text-[34px] font-bold text-black tracking-tight mb-2">Editor</h1>
                <div className="bg-[#e3e3e8] rounded-xl h-9 flex items-center px-3 gap-2 mb-4">
                    <Search className="w-4 h-4 text-gray-500"/>
                    <span className="text-gray-500 text-[17px]">Search settings</span>
                </div>
            </div>

            {/* Scrollable Form */}
            <div className="flex-1 overflow-y-auto no-scrollbar pb-24">
                
                <SettingsSection title="Transaction Details">
                    <SettingsInput label="Amount" name="amount" value={data.amount} onChange={handleChange} placeholder="e.g. -$20,405.00" />
                    <SettingsInput label="Receiver" name="receiver" value={data.receiver} onChange={handleChange} placeholder="e.g. Rong Fan" />
                    <SettingsInput label="Time" name="timestamp" value={data.timestamp} onChange={handleChange} placeholder="Timestamp" isLast />
                </SettingsSection>

                <SettingsSection title="Banking Info">
                    <SettingsInput label="BSB" name="accountBSB" value={data.accountBSB} onChange={handleChange} />
                    <SettingsInput label="Account" name="accountNumber" value={data.accountNumber} onChange={handleChange} />
                    <SettingsInput label="Receipt ID" name="receipt" value={data.receipt} onChange={handleChange} isLast />
                </SettingsSection>

                <SettingsSection>
                    <button 
                        onClick={onReset}
                        className="w-full text-center py-3.5 text-[17px] text-red-500 active:bg-gray-50 transition-colors"
                    >
                        Reset All Data
                    </button>
                </SettingsSection>
                
                <p className="text-center text-gray-400 text-xs px-8 mt-2">
                    Changes reflect immediately on the preview screen.
                </p>
            </div>

            {/* Bottom Floating Action */}
            <div className="absolute bottom-6 left-0 right-0 px-4 z-20">
                <button 
                    onClick={onScreenshot}
                    className="w-full bg-[#007aff] hover:bg-[#0062cc] active:scale-[0.98] transition-all text-white font-semibold text-[17px] py-3.5 rounded-xl shadow-lg flex items-center justify-center gap-2"
                >
                    <Camera className="w-5 h-5" />
                    <span>Download Image</span>
                </button>
            </div>
          </div>
        );
      };


      // --- Component: PaymentScreen (Preview) ---

      const CustomTransferIcon = ({ className }) => (
        // REPLACE THE SRC BELOW WITH YOUR BASE64 STRING
        <img 
            src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=" 
            className={`${className} object-contain`}
            alt="Transfer Icon"
        />
      );

      const DetailRow = ({ label, value }) => (
        <div className="flex justify-between items-start text-sm">
          <span className="text-slate-900 font-semibold">{label}</span>
          <span className="text-slate-600 text-right">{value}</span>
        </div>
      );

      const ActionRow = ({ icon, label, showChevron, rightElement }) => (
        <button className="w-full px-4 py-4 flex items-center justify-between hover:bg-gray-50 transition-colors active:bg-gray-100">
          <div className="flex items-center gap-3">
            {icon && <div>{icon}</div>}
            <span className="text-slate-900 font-medium text-sm">{label}</span>
          </div>
          {showChevron && <ChevronRight className="w-5 h-5 text-gray-300" />}
          {rightElement}
        </button>
      );

      const Switch = ({ checked, onChange }) => (
        <button 
          onClick={() => onChange(!checked)}
          className={`w-12 h-7 rounded-full transition-colors duration-200 ease-in-out relative ${checked ? 'bg-[#0065ba]' : 'bg-gray-200'}`}
        >
          <div className={`absolute top-0.5 left-0.5 w-6 h-6 bg-white rounded-full shadow-md transform transition-transform duration-200 ${checked ? 'translate-x-5' : 'translate-x-0'}`}></div>
        </button>
      );

      const AccountsIcon = (props) => {
        const isActive = props.fill === "#0065ba";
        if (isActive) {
            return (
                <svg viewBox="0 0 24 24" fill="none" {...props}>
                    <rect x="3" y="4" width="18" height="16" rx="3" fill="#0065ba" />
                    <path d="M15 9h2a2 2 0 0 1 2 2v2a2 2 0 0 1-2 2h-2" stroke="white" strokeWidth="1.8" strokeLinecap="round" strokeLinejoin="round" />
                </svg>
            )
        }
        return (
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
                 <rect x="3" y="4" width="18" height="16" rx="3" />
                 <path d="M15 9h2a2 2 0 0 1 2 2v2a2 2 0 0 1-2 2h-2" />
            </svg>
        )
      };

      const NavItem = ({ icon, label, active }) => {
        return (
          <button className={`flex flex-col items-center justify-center w-full py-1 space-y-1 ${active ? 'text-[#0065ba]' : 'text-slate-900'}`}>
            <div className={`w-6 h-6 ${active ? 'fill-current' : ''}`}>
              {React.cloneElement(icon, {
                  className: `w-6 h-6 ${active ? 'text-[#0065ba]' : 'text-slate-900'}`,
                  fill: active ? "#0065ba" : "none"
              })}
            </div>
            <span className="text-[10px] font-medium tracking-wide">{label}</span>
          </button>
        );
      };

      const BottomNav = () => {
        return (
          <div className="absolute bottom-0 left-0 w-full bg-white border-t border-gray-200 pt-2 z-50">
            <div className="w-full flex flex-col">
              <div className="flex justify-between px-2 pb-1">
                  <NavItem icon={<Home strokeWidth={2} />} label="Home" />
                  <NavItem icon={<AccountsIcon />} label="Accounts" active />
                  <NavItem icon={<CircleDollarSign strokeWidth={2} />} label="Pay" />
                  <NavItem icon={<Gift strokeWidth={2} />} label="Offers" />
                  <NavItem icon={<UserCircle2 strokeWidth={2} />} label="Profile" />
              </div>
              <div className="w-full flex justify-center pb-2 pt-2">
                  <div className="w-[134px] h-[5px] bg-black rounded-full opacity-30"></div>
              </div>
            </div>
          </div>
        );
      };

      const PaymentScreen = ({ data }) => {
        const [excludeFromBudget, setExcludeFromBudget] = useState(false);

        return (
          <div className="flex flex-col h-full bg-gray-50 relative font-sans">
            
            {/* Scrollable Container */}
            <div className="flex-1 overflow-y-auto no-scrollbar pb-24 relative">
              
              {/* Blue Header Background Section */}
              <div className="bg-[#0065ba] text-white pb-28 relative z-0">
                <StatusBar theme="light" />

                {/* Navigation Bar */}
                <div className="flex items-center justify-between px-4 py-2 relative z-10">
                  <button className="p-1 hover:bg-white/10 rounded-full transition-colors">
                    <ArrowLeft className="w-6 h-6" />
                  </button>
                  <h1 className="text-lg font-semibold absolute left-1/2 transform -translate-x-1/2">
                    Payment
                  </h1>
                  <div className="w-6"></div> 
                </div>
              </div>

              {/* Main Content - Floating Card Effect */}
              <div className="px-4 -mt-12 relative z-10 space-y-4">
                
                {/* Transaction Summary Card */}
                <div className="bg-white rounded-2xl shadow-sm pt-12 pb-4 px-5 relative flex flex-col items-center">
                  
                  {/* Floating Custom Transfer Icon */}
                  <div className="absolute -top-10 left-1/2 transform -translate-x-1/2">
                     <div className="w-20 h-20 bg-white rounded-[1.25rem] shadow-sm flex items-center justify-center p-1.5">
                        <CustomTransferIcon className="w-full h-full text-[#0065ba]" />
                     </div>
                  </div>

                  <div className="text-center mb-6 mt-2">
                    <h2 className="text-3xl font-bold text-slate-900 tracking-tight">
                      {data.amount}
                    </h2>
                    <p className="text-slate-900 font-medium mt-1 text-sm">
                      To: {data.receiver}
                    </p>
                  </div>

                  <div className="w-full space-y-5 border-t border-gray-100 pt-5">
                    <DetailRow label="When" value={data.timestamp} />
                    <DetailRow label="Account number" value={data.accountNumber} />
                    <DetailRow label="Account BSB" value={data.accountBSB} />
                    <DetailRow label="Receipt" value={data.receipt} />
                  </div>
                </div>

                {/* Action Group 1 */}
                <div className="bg-white rounded-xl shadow-sm overflow-hidden">
                  <ActionRow 
                    icon={<CustomTransferIcon className="w-5 h-5 text-[#0065ba]" />} 
                    label="Transfers" 
                    showChevron 
                  />
                  <div className="h-px bg-gray-100 mx-4"></div>
                  <ActionRow 
                    icon={<Tag className="w-5 h-5 text-[#0065ba]" strokeWidth={2.5} />} 
                    label="Add tag" 
                    showChevron 
                  />
                </div>

                {/* Action Group 2 */}
                <div className="bg-white rounded-xl shadow-sm overflow-hidden">
                  <ActionRow 
                    label="Merchant insights" 
                    showChevron 
                  />
                </div>

                {/* Action Group 3 */}
                <div className="bg-white rounded-xl shadow-sm overflow-hidden">
                  <ActionRow 
                    label="Track this bill" 
                    rightElement={<Plus className="w-5 h-5 text-gray-400" />} 
                  />
                </div>

                {/* Action Group 4 */}
                <div className="bg-white rounded-xl shadow-sm overflow-hidden mb-6">
                  <div className="px-4 py-4 flex items-center justify-between">
                     <span className="text-slate-900 font-medium text-sm">Exclude from budget</span>
                     <Switch checked={excludeFromBudget} onChange={setExcludeFromBudget} />
                  </div>
                </div>
              </div>
            </div>

            <BottomNav />
          </div>
        );
      };

      const defaultData = {
          amount: "-$20,405.00",
          receiver: "Rong Fan",
          timestamp: "23 Dec 2024 at 06:44",
          accountNumber: "0844530",
          accountBSB: "304254",
          receipt: "PI24358273401495"
      };

      // --- Main App ---

      const App = () => {
        const screenRef = useRef(null);
        const [paymentData, setPaymentData] = useState(defaultData);

        const handleScreenshot = async () => {
          if (screenRef.current) {
            try {
              const dataUrl = await toPng(screenRef.current, { quality: 1.0, pixelRatio: 3 });
              const link = document.createElement('a');
              link.download = 'payment-screen.png';
              link.href = dataUrl;
              link.click();
            } catch (err) {
              console.error('Failed to capture screenshot', err);
            }
          }
        };

        const handleReset = () => {
            setPaymentData(defaultData);
        };

        return (
          <div className="min-h-screen flex items-center justify-center p-6 md:p-12 overflow-x-hidden">
            <div className="flex flex-col xl:flex-row gap-16 items-center justify-center">
              
              {/* Left Side: Editor Phone */}
              <div className="flex flex-col items-center animate-in fade-in slide-in-from-bottom-4 duration-700">
                 <div className="mb-4 text-gray-400 text-xs font-semibold tracking-widest uppercase">Configuration</div>
                 <PhoneFrame>
                    <ControlPanel 
                        data={paymentData} 
                        onChange={setPaymentData} 
                        onScreenshot={handleScreenshot}
                        onReset={handleReset}
                    />
                 </PhoneFrame>
              </div>

              {/* Right Side: Preview Phone */}
              <div className="flex flex-col items-center animate-in fade-in slide-in-from-bottom-4 duration-700 delay-100">
                <div className="mb-4 text-gray-400 text-xs font-semibold tracking-widest uppercase">Live Preview</div>
                <PhoneFrame>
                   <div ref={screenRef} className="w-full h-full bg-gray-50">
                      <PaymentScreen data={paymentData} />
                   </div>
                </PhoneFrame>
              </div>

            </div>
          </div>
        );
      };

      const rootElement = document.getElementById('root');
      if (rootElement) {
        const root = createRoot(rootElement);
        root.render(<App />);
      }
    </script>
  </body>
</html>